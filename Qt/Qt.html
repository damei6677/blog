<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="0.qmake语法0.1 关键字TEMPLATE变量用来表示工程将会输出一个可执行程序、库还是一个插件。 关键字默认值是app  app 生成makefile用来编译可执行程序。 lib  subdirs 生成makefile文件用来编译子目录目标。子目录用关键字SUBDIRS来指定。 aux 不编译任何东西。用在解释型语言工程中。 vcapp windos平台专用。生成vs可执行程序工程。 vc">
<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://github.com/damei6677/Qt/Qt.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="0.qmake语法0.1 关键字TEMPLATE变量用来表示工程将会输出一个可执行程序、库还是一个插件。 关键字默认值是app  app 生成makefile用来编译可执行程序。 lib  subdirs 生成makefile文件用来编译子目录目标。子目录用关键字SUBDIRS来指定。 aux 不编译任何东西。用在解释型语言工程中。 vcapp windos平台专用。生成vs可执行程序工程。 vc">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-04-28T02:50:56.230Z">
<meta property="article:modified_time" content="2023-04-28T02:50:56.230Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/blog/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/blog/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/blog/css/style.css">

  
    
<link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/blog/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://github.com/damei6677"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="page-" class="h-entry article article-type-page" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/blog/Qt/Qt.html" class="article-date">
  <time class="dt-published" datetime="2023-04-28T02:50:56.230Z" itemprop="datePublished">2023-04-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="0-qmake语法"><a href="#0-qmake语法" class="headerlink" title="0.qmake语法"></a>0.qmake语法</h1><h2 id="0-1-关键字"><a href="#0-1-关键字" class="headerlink" title="0.1 关键字"></a>0.1 关键字</h2><p>TEMPLATE变量用来表示工程将会输出一个可执行程序、库还是一个插件。</p>
<p>关键字默认值是app</p>
<ul>
<li>app 生成makefile用来编译可执行程序。</li>
<li>lib </li>
<li>subdirs 生成makefile文件用来编译子目录目标。子目录用关键字SUBDIRS来指定。</li>
<li>aux 不编译任何东西。用在解释型语言工程中。</li>
<li>vcapp windos平台专用。生成<strong>vs可执行程序</strong>工程。</li>
<li>vclib windows平台专用。生成<strong>vs库</strong>工程。</li>
</ul>
<p>其他关键字：</p>
<ul>
<li><p>HEADERS 指定工程的 C++头文件（.h）。</p>
</li>
<li><p>SOURCES 指定工程的Ｃ++实现文件（.cpp）。</p>
</li>
<li><p>FORMS 指定需要 uic 处理的由 Qt 设计师生成的.ui 文件。</p>
</li>
<li><p>RESOURCES 指定需要 rcc 处理的.qrc 文件。</p>
</li>
<li><p>DEFINES 指定预定义的 C++预处理符号。</p>
</li>
<li><p>INCLUDEPATH 指定 C++编译器搜索全局头文件的路径。</p>
</li>
<li><p>LIBS 指定工程要链接的库。库既可以通过绝对路径指定，也可以使用源自 Unix 的- L 和-l 标识符来指定（例如，-L&#x2F;usr&#x2F;local&#x2F;lib 和-ldb_cxx）。</p>
</li>
<li><p>CONFIG 指定各种用于工程配置和编译的参数。</p>
</li>
<li><p>QT 指定所要使用的 Qt 模块（默认是 core gui，对应于 QtCore 和 QtGui 模块）。</p>
</li>
<li><p>VERSION 指定目标库的版本号。</p>
</li>
<li><p>TARGET 指定可执行文件或库的基本文件名，其中不包含任何的扩展、前缀或版本 号（默认的是当前的目录名）。</p>
</li>
<li><p>DESTDIR 指定可执行文件放置的目录（默认值是平台相关的。例如，在 Linux 上，指当前目录；在 Windows 上，则是指 debug 或 release 子目 录）。</p>
</li>
<li><p>DLLDESTDIR 指定目标库文件放置的目录（默认路径与 DESTDIR 相同）。</p>
</li>
<li><p>CONFIG 变量用来控制编译过程中的各个方面。它支持下面这些参数：</p>
<ul>
<li>debug 是指具有调试信息的可执行文件或者库，链接 Qt 库的调试版。</li>
<li>release 是指编译不具有调试信息的可执行文件或者库，链接发行版的 Qt 库。如果 同时指定 debug 和 release，则 debug 有效。</li>
<li>warn_off 会关闭大量的警告。默认情况下，警告的状态是打开的。</li>
<li>qt 是指应用程序或者库使用 Qt。这一选项是默认包括的。</li>
<li>dll 是指动态编译库。</li>
<li>staticlib 是指静态编译库。</li>
<li>plugin 是指编译一个插件。插件总是动态库，因此这一参数暗含 dll 参数。</li>
<li>console 是指应用程序需要写控制台（使用 cout、cerr、qWarning()，等等）。</li>
<li>app_bundle 只适用于 Mac OS X 编译，是指可执行文件被放到束中，这是 Mac OS X 的默认情况。</li>
<li>lib_bundle 只适用于 Mac OS X 编译，指库被放到框架中。</li>
</ul>
</li>
</ul>
<h2 id="0-2-使用举例"><a href="#0-2-使用举例" class="headerlink" title="0.2 使用举例"></a>0.2 使用举例</h2><h3 id="0-2-1-C-11"><a href="#0-2-1-C-11" class="headerlink" title="0.2.1 C++11"></a>0.2.1 C++11</h3>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#支持C++<span class="number">11</span> gcc4<span class="number">.7</span>开始支持C++<span class="number">11</span></span><br><span class="line">CONFIG += c++<span class="number">11</span></span><br><span class="line">#或者，有时必须要下面的写法</span><br><span class="line">QMAKE_CXXFLAGS += -<span class="built_in">std</span>=c++<span class="number">11</span></span><br></pre></td></tr></table></figure>

<h3 id="0-2-2-多个子工程"><a href="#0-2-2-多个子工程" class="headerlink" title="0.2.2 多个子工程"></a>0.2.2 多个子工程</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#pro文件</span></span><br><span class="line">TEMPLATE = subdirs</span><br><span class="line"></span><br><span class="line">#SUBDIRS += \</span><br><span class="line">#    SubProject3 \</span><br><span class="line">#    SubProject2 \</span><br><span class="line">#    SubProject</span><br><span class="line"></span><br><span class="line">SUBDIRS += $$PWD/SubProject3/SubProject3.pro \</span><br><span class="line">           $$PWD/SubProject2/SubProject2.pro \</span><br><span class="line">           $$PWD/SubProject/SubProject.pro</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="0-2-3-debug-x2F-release文件生成到不同目录"><a href="#0-2-3-debug-x2F-release文件生成到不同目录" class="headerlink" title="0.2.3 debug&#x2F;release文件生成到不同目录"></a>0.2.3 debug&#x2F;release文件生成到不同目录</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">CONFIG += debug_and_release</span><br><span class="line"><span class="built_in">CONFIG</span>(debug, debug|release)&#123;</span><br><span class="line">    TARGET = ../../bin/Rocker</span><br><span class="line">	<span class="built_in">message</span>(<span class="string">&quot;build debug&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    TARGET = ../../bin-release/Rocker</span><br><span class="line">	<span class="built_in">message</span>(<span class="string">&quot;build release&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//或者简单的使用</span></span><br><span class="line"><span class="built_in">CONFIG</span>(release)&#123;</span><br><span class="line"><span class="built_in">warning</span>(release ---------------)</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="built_in">warning</span>(debug+++++)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="0-2-4-宏"><a href="#0-2-4-宏" class="headerlink" title="0.2.4 宏"></a>0.2.4 宏</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#禁止打印信息</span><br><span class="line">DEFINES += QT_NO_WARNING_OUTPUT</span><br><span class="line">DEFINES += QT_NO_DEBUG_OUTPUT</span><br></pre></td></tr></table></figure>

<p>0.2.4 linux环境下使用pthread库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LIBS += -lpthread</span><br></pre></td></tr></table></figure>

<p>0.2.5 pro文件中获得build路径</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DEFINES += <span class="string">&quot;BUILD_DIR=\&quot;\\\&quot;&quot;</span>$$OUT_PWD<span class="string">&quot;\\\&quot;\&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>0.2.5 拷贝文件到指定目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">win32 &#123;</span><br><span class="line">    COPY_FILES += \</span><br><span class="line">        $$&#123;PWD&#125;/main.cpp \</span><br><span class="line">        $$PWD/../images/img.jpg</span><br><span class="line"></span><br><span class="line">    COPY_PWD = $$replace(PWD, /, \\)</span><br><span class="line">    COPY_DEST = $$replace(OUT_PWD, /, \\)</span><br><span class="line"></span><br><span class="line">    for(FILE,COPY_FILES)&#123;</span><br><span class="line">        FOR_FILE = $$replace(FILE, /, \\)</span><br><span class="line">        system(&quot;copy  $$FOR_FILE  $$COPY_DEST&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="0-3-常用功能"><a href="#0-3-常用功能" class="headerlink" title="0.3 常用功能"></a>0.3 常用功能</h2><h3 id="0-3-1-debug-x2F-release"><a href="#0-3-1-debug-x2F-release" class="headerlink" title="0.3.1 debug&#x2F;release"></a>0.3.1 debug&#x2F;release</h3><p>代码中判断是debug版本还是release版本</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> QT_NO_DEBUG</span></span><br><span class="line"><span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;release mode&quot;</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;debug mode&quot;</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<h3 id="0-3-2-代码中判断Qt版本QT-VERSION"><a href="#0-3-2-代码中判断Qt版本QT-VERSION" class="headerlink" title="0.3.2 代码中判断Qt版本QT_VERSION"></a>0.3.2 代码中判断Qt版本QT_VERSION</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">if</span> (QT_VERSION &lt;= QT_VERSION_CHECK(5,0,0))</span></span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;4&quot;</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;5&quot;</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<h3 id="0-3-3-Qt4支持中文"><a href="#0-3-3-Qt4支持中文" class="headerlink" title="0.3.3 Qt4支持中文"></a>0.3.3 Qt4支持中文</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//支持中文编码</span></span><br><span class="line">  <span class="comment">//UTF-8  GBK system GB2312</span></span><br><span class="line">  QTextCodec *codec = QTextCodec::<span class="built_in">codecForName</span>(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">  QTextCodec::<span class="built_in">setCodecForLocale</span>(codec);</span><br><span class="line">  QTextCodec::<span class="built_in">setCodecForCStrings</span>(codec);</span><br><span class="line">  QTextCodec::<span class="built_in">setCodecForTr</span>(codec);</span><br></pre></td></tr></table></figure>



<h2 id="0-4-获取硬件信息"><a href="#0-4-获取硬件信息" class="headerlink" title="0.4 获取硬件信息"></a>0.4 获取硬件信息</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xiezhongyuan07/article/details/80249626">https://blog.csdn.net/xiezhongyuan07/article/details/80249626</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取cpu信息</span></span><br><span class="line">QSettings *CPU = <span class="keyword">new</span> <span class="built_in">QSettings</span>(<span class="string">&quot;HKEY_LOCAL_MACHINE\\HARDWARE\\DESCRIPTION\\System\\CentralProcessor\\0&quot;</span>,QSettings::NativeFormat);</span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt; CPU-&gt;<span class="built_in">value</span>(<span class="string">&quot;ProcessorNameString&quot;</span>).<span class="built_in">toString</span>();</span><br><span class="line"><span class="keyword">delete</span> CPU;</span><br></pre></td></tr></table></figure>





<h1 id="1-Qt5信号槽"><a href="#1-Qt5信号槽" class="headerlink" title="1. Qt5信号槽"></a>1. Qt5信号槽</h1><h2 id="1-0-信号槽连接类型，第五个参数"><a href="#1-0-信号槽连接类型，第五个参数" class="headerlink" title="1.0 信号槽连接类型，第五个参数"></a>1.0 信号槽连接类型，第五个参数</h2><h2 id="1-1-Qt4与Qt5对比"><a href="#1-1-Qt4与Qt5对比" class="headerlink" title="1.1 Qt4与Qt5对比"></a>1.1 Qt4与Qt5对比</h2><p>​	Qt4信号槽写法</p>
<figure class="highlight qt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">connect(sender,SIGNAL(valueChanged(QString,QString)),</span><br><span class="line">		receiver,SLOT(showValue(QString)));</span><br></pre></td></tr></table></figure>

<p>Qt4的SIGNAL和SLOT两个宏实际是将其参数转换成相应的字符串。在编译之前，Qt的moc工具从源代码中提取出所需要的元数据，形成一张由使用了signal和slots修饰的所有函数形成的字符串表。</p>
<p>​	这种方式有两个缺点：</p>
<ul>
<li><p>没有编译期检查。由于信号和槽会被SIGNAL和SLOT宏处理成字符串，字符串的对比是在运行期完成的，并且失去了类型信息。所以，编写Qt4程序时，可能会出现编译通过但是运行时原本应该调用的槽函数没有执行的情况。此时，编译器不能给出任何错误信息，只能在运行时看有没有警告，看运行时槽函数有没有被执行。</p>
</li>
<li><p>无法使用相容类型的参数。由于connect函数使用的是字符串对比，所以槽函数的参数类型的名字必须和信号的完全一致，也必须与头文件中的类型一致。这里的“一致”是严格的字符串意义上的相同。因此，那些使用了typedef或者namespace的类型，即便实际类型时相同的，依然可能由于字符串名字不一样而不能正常工作。</p>
</li>
</ul>
<p>Qt5提供了全新的信号槽语法，前面的语句可以写成：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">connect</span>(sender,&amp;Sender::valueChanged,receiver,$Receiver::showValue);</span><br></pre></td></tr></table></figure>

<p>新的语法优点：</p>
<ul>
<li><p>支持编译器检查。新语法可以在编译期进行检查，信号或槽的拼写错误、槽函数参数数目与信号不匹配等错误在编译期就可以被发现。</p>
</li>
<li><p>支持相容参数类型的自动转换。新的语法不仅支持使用typdef或者命名空间，还支持使用隐式类型转换。例如，当信号参数类型时QString，而槽函数对应的参数类型是QVariant时，在进行信号槽的连接时，QString将被自动转换成QVariant。这是因为QVariant有一个可以使用QString为参数的隐式构造函数。</p>
</li>
<li><p>允许链接到任意函数。在Qt4中，信号槽只能使用slots关键字修饰的成员函数，而新的语法则通过函数指针直接调用函数，任意成员函数、静态函数或者C++11 Lambda表达式都可以作为槽进行关联。（Qt4的信号槽语法是不受private限制的。槽函数虽然可以被声明为private，但仅仅在作为普通函数调用时起作用，作为槽函数连接时，SLOT无视private修饰，因为仅作为字符串连接。而新的语法无法获取私有函数指针，编译时就会有警报，因而更安全。）</p>
</li>
</ul>
<h3 id="1-2-Qt5信号槽新语法"><a href="#1-2-Qt5信号槽新语法" class="headerlink" title="1.2 Qt5信号槽新语法"></a>1.2 Qt5信号槽新语法</h3><h4 id="槽函数为静态函数"><a href="#槽函数为静态函数" class="headerlink" title="槽函数为静态函数"></a>槽函数为静态函数</h4><p>  ​	除了可以将普通成员函数作为槽函数，Qt5新语法还允许使用任意类的静态函数。有如下语句：</p>
  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">connect</span>(dlg,&amp;StringDialog::stringChanged,&amp;QApplication::quit);</span><br></pre></td></tr></table></figure>

<p>  ​	这里，dialog的string发生变化时，调用QApplication的静态函数quit实现程序的退出。</p>
<p>  ​	如果使用Qt4的语法来实现以上功能，必须使用使用一个成员函数封装这个静态函数。使用Qt5新的信号槽语法可以直接将信号关联到静态函数。（这里接收信号receiver对象是this,允许进行省略。）</p>
<h4 id="信号为重载函数"><a href="#信号为重载函数" class="headerlink" title="信号为重载函数"></a>信号为重载函数</h4><p>​	当信号有重载情况时，使用Qt5的新语法可能会有一些不方便。例如，QSpinBox有两个重载的信号：</p>
<ul>
<li><p>void valueChanged(int i)；</p>
</li>
<li><p>void valueChanged(const QString&amp;text);</p>
<p>当使用下面的语句进行连接时，</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">connect</span>(spinBox,&amp;QSpinBox::valueChanged,</span><br><span class="line">	<span class="keyword">this</span>,&amp;MainWindow::onSpinBoxValueChanged);</span><br></pre></td></tr></table></figure>

<p>​	编译器会发出一个错误。因为信号valueChanged有重载，所以使用&amp;QSpinBox::valueChanged语句获取信号的指针时会有歧义：有两个相同名字的信号。未解决这个语法，一方面，可以使用Qt4类型的旧的信号槽连接语句。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">connect</span>(spinBox,<span class="built_in">SIGNAL</span>(<span class="built_in">valueChanged</span>(<span class="type">int</span>)),</span><br><span class="line">	<span class="keyword">this</span>,<span class="built_in">SLOT</span>(<span class="built_in">slotSpinBoxValueChanged</span>(<span class="type">int</span>)));</span><br></pre></td></tr></table></figure>

<p>​	由于SIGNAL和SLOT两个宏都要求指明参数类型，所以不会出现歧义。但是又失去了编译期检查的优点。可以使用如下语法。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QObject::<span class="built_in">connect</span>(spinBox,<span class="built_in">static_cast</span>&lt;<span class="built_in">void</span>(QSpinBox::*)(<span class="type">int</span>)&gt;(&amp;QSpinBox::valueChanged),</span><br><span class="line">		<span class="keyword">this</span>,&amp;MainWindow::onSpinBoxValueChanged);</span><br></pre></td></tr></table></figure>

<h4 id="槽函数与lambda"><a href="#槽函数与lambda" class="headerlink" title="槽函数与lambda"></a>槽函数与lambda</h4><p>​	当一个没有参数的信号aSignal()想连接到一个具有默认参数的槽函数上面。槽函数为：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">animateClick</span><span class="params">(<span class="type">int</span> msec = <span class="number">100</span>)</span></span>;</span><br></pre></td></tr></table></figure>

<p>​	当使用新的信号槽语法时：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">connect</span>(myWidget,&amp;MyWidget:;aSignal,</span><br><span class="line">	pushButton,&amp;QPushButton::animateClick);</span><br></pre></td></tr></table></figure>

<p>​	编译期会给出一个错误。大致是说，槽函数所要求的参数个数比信号提供的要多。这个函数的默认参数只有在直接调用时才有效。在取函数地址时，编译器是看不到参数默认值的。这种情况下可以使用Qt4的槽函数语法。</p>
<p>​	Qt5可以使用C++11 lambda表达式：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">connect</span>(myWidget,&amp;MyWidget:;aSignal,</span><br><span class="line">	[]&#123;pushButton-&gt;<span class="built_in">animateClick</span>();&#125;;</span><br></pre></td></tr></table></figure>

<p>​	</p>
<h1 id="2-构造函数parent的作用"><a href="#2-构造函数parent的作用" class="headerlink" title="2.构造函数parent的作用"></a>2.构造函数parent的作用</h1><p>1.调用父类的构造函数，初始化父类中的成员变量。</p>
<p>2.ui界面类明确继承关系，便于ui类显示。</p>
<p>3.程序关闭时，系统根据继承关系，一次销毁对象，回收资源。</p>
<h1 id="3-QEventLoop"><a href="#3-QEventLoop" class="headerlink" title="3.QEventLoop"></a>3.QEventLoop</h1><p>3.1 QThread线程run函数中获取netwrokreply</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">QEventLoop eventLoop;</span><br><span class="line">QObject::<span class="built_in">connect</span>(reply, &amp;QNetworkReply::finished, &amp;eventLoop, &amp;QEventLoop::quit);</span><br><span class="line">eventLoop.<span class="built_in">exec</span>();</span><br></pre></td></tr></table></figure>

<p>3.2 主线程中希望延时100毫秒。使用sleep主界面会停止响应，但是使用事件可以避免。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> QEventLoop loop;</span><br><span class="line"><span class="number">2</span> QTimer::<span class="built_in">singleShot</span>(<span class="number">100</span>, &amp;loop, <span class="built_in">SLOT</span>(<span class="built_in">quit</span>()));</span><br><span class="line"><span class="number">3</span> loop.<span class="built_in">exec</span>();</span><br></pre></td></tr></table></figure>

<p>3.3 一个槽函数中需要弹出一个静态对话框，如果使用注释掉的代码，对话框会一闪而过。通过延长生存周期的方法。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">if</span> 0</span></span><br><span class="line"><span class="number">1</span> <span class="type">void</span> ****::mySLot&#123;</span><br><span class="line"><span class="number">2</span>     QDialog dlg;</span><br><span class="line"><span class="number">3</span>     dlg.<span class="built_in">show</span>();</span><br><span class="line"><span class="number">4</span> &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> </span></span><br><span class="line"><span class="number">1</span> <span class="type">void</span> ****::mySLot&#123;</span><br><span class="line"><span class="number">2</span>     QDialog dlg;</span><br><span class="line"><span class="number">3</span>     dlg.<span class="built_in">show</span>();</span><br><span class="line"><span class="number">4</span>     QEventLoop loop;</span><br><span class="line"><span class="number">5</span>     <span class="built_in">connect</span>(&amp;dlg, <span class="built_in">SIGNAL</span>(<span class="built_in">finished</span>(<span class="type">int</span>)), &amp;loop, <span class="built_in">SLOT</span>(<span class="built_in">quit</span>()));</span><br><span class="line"><span class="number">6</span>     loop.<span class="built_in">exec</span>(QEventLoop::ExcludeUserInputEvents);</span><br><span class="line"><span class="number">7</span> &#125;</span><br></pre></td></tr></table></figure>



<h1 id="4-QString"><a href="#4-QString" class="headerlink" title="4.QString"></a>4.QString</h1><h2 id="4-1-截取字符串"><a href="#4-1-截取字符串" class="headerlink" title="4.1 截取字符串"></a>4.1 截取字符串</h2><p>从路径中截取文件名</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//str.mid(str.lastIndexOf(&quot;/&quot;) + 1,str.size());</span></span><br><span class="line"><span class="comment">//qstrUrl.right(qstrUrl.size() - qstrUrl.lastIndexOf(&quot;/&quot;) - 1)</span></span><br><span class="line"></span><br><span class="line">QString str = <span class="string">&quot;fewf/fewaf/fewaf/dsaf.txt&quot;</span>;</span><br><span class="line"><span class="type">int</span> index = str.<span class="built_in">lastIndexOf</span>(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">QString s = str.<span class="built_in">right</span>(index);</span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;index;</span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;s;</span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;str.<span class="built_in">mid</span>(index + <span class="number">1</span>,str.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line"><span class="number">16</span></span><br><span class="line"><span class="string">&quot;f/fewaf/dsaf.txt&quot;</span></span><br><span class="line"><span class="string">&quot;dsaf.txt&quot;</span></span><br></pre></td></tr></table></figure>

<p>4.2 </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4-2-转化"><a href="#4-2-转化" class="headerlink" title="4.2.转化"></a>4.2.转化</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.QString &amp;&amp; char*</span></span><br><span class="line"><span class="comment">//1.1 QString转化为QByteArray类型，然后由QByteArray再转化为char* </span></span><br><span class="line">QString a; </span><br><span class="line"><span class="type">char</span> b[<span class="number">20</span>]; </span><br><span class="line">QByteArray c= a.<span class="built_in">toLocal8Bit</span>(); </span><br><span class="line"><span class="built_in">strcpy</span>(b, c.<span class="built_in">data</span>());</span><br><span class="line"><span class="comment">//1.2 QString转化为string类型，然后由string转化char* </span></span><br><span class="line">QString a; </span><br><span class="line"><span class="type">char</span> b[<span class="number">20</span>]; </span><br><span class="line">std::string s= a.<span class="built_in">toStdString</span>(); </span><br><span class="line">b= s.<span class="built_in">c_str</span>(); </span><br><span class="line"><span class="comment">//1.3char*转QString</span></span><br><span class="line">QString a; </span><br><span class="line"><span class="type">char</span> b[<span class="number">20</span>]; </span><br><span class="line">a= <span class="built_in">QString</span>(<span class="string">&quot;%1&quot;</span>).<span class="built_in">arg</span>(b); </span><br><span class="line"><span class="comment">//1.4std::string to QString</span></span><br><span class="line">std::string stdStr = <span class="string">&quot;nanme&quot;</span>;</span><br><span class="line">QString qstr = QString::<span class="built_in">fromUtf8</span>(stdStr.<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.QByteArray char*</span></span><br></pre></td></tr></table></figure>



<h1 id="5-获取电脑信息"><a href="#5-获取电脑信息" class="headerlink" title="5.获取电脑信息"></a>5.获取电脑信息</h1><h2 id="Qt4"><a href="#Qt4" class="headerlink" title="Qt4"></a>Qt4</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取计算机名称</span></span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;QHostInfo::<span class="built_in">localHostName</span>();</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取本机ip地址，一般是一个ipv4，一个ipv6</span></span><br><span class="line">QHostInfo info = QHostInfo::<span class="built_in">fromName</span>(QHostInfo::<span class="built_in">localHostName</span>());</span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;info.<span class="built_in">addresses</span>();</span><br><span class="line"><span class="comment">//输出为：(QHostAddress(&quot;FE80::C028:D437:616A:5B17&quot;) ,   QHostAddress( &quot;192.168.3.74&quot; )  )  </span></span><br></pre></td></tr></table></figure>
<p>使用QNetworkInterface获取硬件信息。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//QNetworkInterface 获取详细网络信息，可以通过mac地址来区别机器</span></span><br><span class="line">QList&lt;QNetworkInterface&gt; niList = QNetworkInterface::<span class="built_in">allInterfaces</span>();</span><br><span class="line">    foreach(QNetworkInterface ni,niList)&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;hardwareAddress:&quot;</span>&lt;&lt;ni.<span class="built_in">hardwareAddress</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;humanReadableName:&quot;</span>&lt;&lt;ni.<span class="built_in">humanReadableName</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;name:&quot;</span>&lt;&lt;ni.<span class="built_in">name</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//输出为：</span></span><br><span class="line">hardwareAddress: <span class="string">&quot;00:E0:70:60:7E:D3&quot;</span> </span><br><span class="line">humanReadableName: <span class="string">&quot;以太网&quot;</span> </span><br><span class="line">name: <span class="string">&quot;&#123;C5BAB4C8-B12E-4A45-9ADB-63056ED50656&#125;&quot;</span> </span><br><span class="line"></span><br><span class="line">hardwareAddress: <span class="string">&quot;30:B4:9E:8B:3A:69&quot;</span> </span><br><span class="line">humanReadableName: <span class="string">&quot;本地连接* 9&quot;</span> </span><br><span class="line">name: <span class="string">&quot;&#123;8435B19D-9D89-4789-AD88-B6EFFA13A84D&#125;&quot;</span> </span><br><span class="line"></span><br><span class="line">hardwareAddress: <span class="string">&quot;30:B4:9E:8B:3A:6F&quot;</span> </span><br><span class="line">humanReadableName: <span class="string">&quot;WLAN&quot;</span> </span><br><span class="line">name: <span class="string">&quot;&#123;B0FE0D27-4841-4D55-8061-FF8DC55CD3FF&#125;&quot;</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="Qt5"><a href="#Qt5" class="headerlink" title="Qt5"></a>Qt5</h2><p>Qt4 QSysInfo 类中的函数只能返回计算机信息的枚举类型</p>
<p>Qt5 QSysInfo 增加了多个静态函数，可以获取计算机信息</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;QSysInfo------------------------------------&quot;</span>;</span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;QSysInfo::<span class="built_in">buildAbi</span>();</span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;QSysInfo::<span class="built_in">buildCpuArchitecture</span>();</span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;QSysInfo::<span class="built_in">currentCpuArchitecture</span>();</span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;QSysInfo::<span class="built_in">kernelType</span>();</span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;QSysInfo::<span class="built_in">kernelVersion</span>();</span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;QSysInfo::<span class="built_in">machineHostName</span>();</span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;QSysInfo::<span class="built_in">machineUniqueId</span>();</span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;QSysInfo::<span class="built_in">prettyProductName</span>();</span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;QSysInfo::<span class="built_in">productType</span>();</span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;QSysInfo::<span class="built_in">productVersion</span>();</span><br><span class="line"><span class="comment">//输出为：</span></span><br><span class="line">QSysInfo------------------------------------</span><br><span class="line"><span class="string">&quot;x86_64-little_endian-llp64&quot;</span></span><br><span class="line"><span class="string">&quot;x86_64&quot;</span></span><br><span class="line"><span class="string">&quot;x86_64&quot;</span></span><br><span class="line"><span class="string">&quot;winnt&quot;</span></span><br><span class="line"><span class="string">&quot;10.0.17763&quot;</span></span><br><span class="line"><span class="string">&quot;DESKTOP-9PVBAMG&quot;</span></span><br><span class="line"><span class="string">&quot;96c50bee-73c4-446e-8927-571a5493762a&quot;</span></span><br><span class="line"><span class="string">&quot;Windows 10 (10.0)&quot;</span></span><br><span class="line"><span class="string">&quot;windows&quot;</span></span><br><span class="line"><span class="string">&quot;10&quot;</span></span><br></pre></td></tr></table></figure>

<h1 id="6-QDir-QFile"><a href="#6-QDir-QFile" class="headerlink" title="6.QDir\QFile"></a>6.QDir\QFile</h1><p>获得当前程序执行目录</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取程序当前目录</span></span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;QCoreApplication::<span class="built_in">applicationDirPath</span>();</span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;QCoreApplication::<span class="built_in">applicationFilePath</span>();</span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;QCoreApplication::<span class="built_in">applicationPid</span>();</span><br></pre></td></tr></table></figure>

<p>QDir判断目录是否存在</p>
<p>QFile判断某文件是否存在</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Qdir dir(path);</span></span><br><span class="line"><span class="function">QFile <span class="title">file</span><span class="params">(path)</span></span>;</span><br><span class="line"><span class="keyword">if</span>(file.<span class="built_in">exists</span>())&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;file exists.&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;file not exists.&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="7-延时-QTimer"><a href="#7-延时-QTimer" class="headerlink" title="7.延时\QTimer"></a>7.延时\QTimer</h1><h2 id="1-非子线程中"><a href="#1-非子线程中" class="headerlink" title="1.非子线程中"></a>1.非子线程中</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//当前线程非阻塞</span></span><br><span class="line">QTime t;</span><br><span class="line">t.<span class="built_in">start</span>();</span><br><span class="line"><span class="keyword">while</span>(t.<span class="built_in">elapsed</span>()&lt;<span class="number">1000</span> * <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    QCoreApplication::<span class="built_in">processEvents</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//当前线程阻塞</span></span><br><span class="line">QElapsedTimer et;</span><br><span class="line">et.<span class="built_in">start</span>();</span><br><span class="line"><span class="keyword">while</span>(et.<span class="built_in">elapsed</span>() &lt; <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>



<h2 id="2-子线程"><a href="#2-子线程" class="headerlink" title="2.子线程"></a>2.子线程</h2><p>多线程程序使用</p>
<p>QThread::sleep()或者QThread::msleep()或QThread::usleep()或QThread::wait()进行延时处理。</p>
<p>sleep不会释放对象锁，其他线程无法访问对象，因此会阻塞线程；</p>
<p>而Wait会释放对象锁，使得其他线程能够访问该对象。</p>
<h1 id="8-modbus"><a href="#8-modbus" class="headerlink" title="8.modbus"></a>8.modbus</h1><h1 id="9-QThread-amp-QThreadPool"><a href="#9-QThread-amp-QThreadPool" class="headerlink" title="9.QThread&amp;QThreadPool"></a>9.QThread&amp;QThreadPool</h1><h2 id="9-1-moveToThread"><a href="#9-1-moveToThread" class="headerlink" title="9.1 moveToThread"></a>9.1 moveToThread</h2><p><a href="https://github.com/czyt1988/czyBlog/tree/master/tech/QtThread">Qt使用多线程的一些心得</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/naibozhuan3744/article/details/81201502">Qt5.9继承QObject创建多线程实例（第二种方法）</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//void QObject::moveToThread(QThread *targetThread)    </span></span><br><span class="line"><span class="number">1</span> Task继承自QObject，使用QObject的静态函数moveToThread。</span><br><span class="line"><span class="number">2</span> 当点击stop按钮时，如果子线程中的任务没有完成，wait函数将阻塞，直到Task任务完成。</span><br><span class="line"></span><br><span class="line"><span class="built_in">connect</span>(ui-&gt;pushButtonStart,&amp;QPushButton::clicked,</span><br><span class="line">            [&amp;]&#123;</span><br><span class="line">        m_pTask = <span class="keyword">new</span> Task;</span><br><span class="line">        m_pThread = <span class="keyword">new</span> QThread;</span><br><span class="line">        <span class="comment">//将任务移动到子线程中</span></span><br><span class="line">        m_pTask-&gt;<span class="built_in">moveToThread</span>(m_pThread);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//终止线程时要调用Task deleteLater函数，否则内存泄漏。</span></span><br><span class="line">        <span class="built_in">connect</span>(m_pThread,&amp;QThread::finished,</span><br><span class="line">                m_pTask,&amp;QObject::deleteLater);</span><br><span class="line">        <span class="comment">//开启任务执行槽函数,当线程启动，started信号将被发送</span></span><br><span class="line">        <span class="built_in">connect</span>(m_pThread,&amp;QThread::started,</span><br><span class="line">                m_pTask,&amp;Task::slotStartTask);</span><br><span class="line">        <span class="comment">//启动线程</span></span><br><span class="line">        m_pThread-&gt;<span class="built_in">start</span>();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">connect</span>(ui-&gt;pushButtonStop,&amp;QPushButton::clicked,</span><br><span class="line">            [&amp;]&#123;</span><br><span class="line">        <span class="keyword">if</span>(m_pThread-&gt;<span class="built_in">isRunning</span>())&#123;</span><br><span class="line">            <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;pushButtonStop clicked&quot;</span>;</span><br><span class="line"><span class="comment">//            m_pTask-&gt;setStop();</span></span><br><span class="line">            m_pThread-&gt;<span class="built_in">quit</span>();</span><br><span class="line">            m_pThread-&gt;<span class="built_in">wait</span>();</span><br><span class="line">            <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;MainWindow stop thread,wait return.&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>



<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">在主线程函数中构造Task类并且放到子线程中，启动子线程，但是并不执行Task类的任务函数。主线程中在合适的时机发送相应信号启动Task中的任务执行函数。</span></span><br><span class="line"><span class="comment">注意：在主线程中调用Task的任务处理函数不能成功，必须使用信号槽的方式调用Task中的任务处理函数。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">	m_pTask = <span class="keyword">new</span> Task;</span><br><span class="line">    m_pThread = <span class="keyword">new</span> QThread;</span><br><span class="line">    <span class="comment">//将任务移动到子线程中</span></span><br><span class="line">    m_pTask-&gt;<span class="built_in">moveToThread</span>(m_pThread);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//终止线程时要调用Task deleteLater函数</span></span><br><span class="line">    <span class="built_in">connect</span>(m_pThread,&amp;QThread::finished,</span><br><span class="line">            m_pTask,&amp;QObject::deleteLater);</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 0</span></span><br><span class="line">    <span class="comment">//开启任务执行槽函数,当线程启动，started信号将被发送</span></span><br><span class="line">    <span class="built_in">connect</span>(m_pThread,&amp;QThread::started,</span><br><span class="line">            m_pTask,&amp;Task::slotStartTask);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="built_in">connect</span>(<span class="keyword">this</span>,&amp;MainWindow::sigStartTask,</span><br><span class="line">            m_pTask,&amp;Task::slotStartTask);</span><br><span class="line">    <span class="comment">//启动线程</span></span><br><span class="line">    m_pThread-&gt;<span class="built_in">start</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">connect</span>(ui-&gt;pushButtonStart,&amp;QPushButton::clicked,</span><br><span class="line">            [&amp;]&#123;</span><br><span class="line"><span class="comment">//        m_pTask-&gt;slotStartTask();</span></span><br><span class="line">    emit <span class="keyword">this</span>-&gt;<span class="built_in">sigStartTask</span>();</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">connect</span>(ui-&gt;pushButtonStop,&amp;QPushButton::clicked,</span><br><span class="line">            [&amp;]&#123;</span><br><span class="line">        <span class="keyword">if</span>(m_pThread-&gt;<span class="built_in">isRunning</span>())&#123;</span><br><span class="line">            <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;pushButtonStop clicked&quot;</span>;</span><br><span class="line">                      m_pTask-&gt;<span class="built_in">setStop</span>();</span><br><span class="line">            m_pThread-&gt;<span class="built_in">quit</span>();</span><br><span class="line">            m_pThread-&gt;<span class="built_in">wait</span>();</span><br><span class="line">            <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;MainWindow stop thread,wait return.&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>



<h2 id="9-2-继承QThread"><a href="#9-2-继承QThread" class="headerlink" title="9.2 继承QThread"></a>9.2 继承QThread</h2><p>继承QThread类，重写run函数，调用start函数即可运行run函数。</p>
<p>创建多线程步骤如下：</p>
<p>a1新建一个类MyThread，基类为QThread。</p>
<p>a2重写类MyThread的虚函数void run();，即新建一个函数protected void run()，然后对其进行定义。</p>
<p>a3在需要用到多线程的地方，实例MyThread，然后调用函数MyThread::start()后，则开启一条线程，自动运行函数run()。</p>
<p>a4当停止线程时，调用MyThread::wait()函数，等待线程结束，并且回收线程资源。</p>
<h2 id="9-3-QThreadPool-amp-QRunnable"><a href="#9-3-QThreadPool-amp-QRunnable" class="headerlink" title="9.3 QThreadPool&amp;QRunnable"></a>9.3 QThreadPool&amp;QRunnable</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*class TaskRunnable:public QObject ,public QRunnable</span></span><br><span class="line"><span class="comment">1、TaskRunnable多重继承QObject和QRunnable，使用信号槽向外发送数据</span></span><br><span class="line"><span class="comment">2、tr-&gt;setAutoDelete(true);执行结束自动删除。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#123;</span><br><span class="line">	TaskRunnable *tr = <span class="keyword">new</span> <span class="built_in">TaskRunnable</span>();</span><br><span class="line">    <span class="built_in">connect</span>(tr,&amp;TaskRunnable::sigSendData,</span><br><span class="line">            <span class="keyword">this</span>,&amp;MainWindow::slotRevData);</span><br><span class="line">    tr-&gt;<span class="built_in">setAutoDelete</span>(<span class="literal">true</span>);</span><br><span class="line">    QThreadPool::<span class="built_in">globalInstance</span>()-&gt;<span class="built_in">start</span>(tr);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TaskRunnable::run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i)    &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;thread id:&quot;</span>&lt;&lt;QThread::<span class="built_in">currentThreadId</span>()</span><br><span class="line">               &lt;&lt;<span class="string">&quot;|&quot;</span>&lt;&lt;QDateTime::<span class="built_in">currentDateTime</span>().<span class="built_in">toString</span>(Qt::ISODateWithMs);</span><br><span class="line">        QThread::<span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">emit <span class="title">sigSendData</span><span class="params">(<span class="number">100</span>)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="9-4-QWaitCondition"><a href="#9-4-QWaitCondition" class="headerlink" title="9.4 QWaitCondition"></a>9.4 QWaitCondition</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">QMutex mutex;</span><br><span class="line">QWaitCondition wcBufferFull;</span><br><span class="line">QWaitCondition wcBufferEmpty;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> bufferCount = <span class="number">0</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> ConMaxCount = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Producer::run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">10000</span>; ++i)&#123;</span><br><span class="line">        mutex.<span class="built_in">lock</span>();</span><br><span class="line">        <span class="keyword">if</span>(bufferCount == ConMaxCount)&#123; <span class="comment">//当产品数量达到最大值时，生产者阻塞，不再生产。</span></span><br><span class="line">            wcBufferFull.<span class="built_in">wait</span>(&amp;mutex);</span><br><span class="line">        &#125;</span><br><span class="line">        mutex.<span class="built_in">unlock</span>();</span><br><span class="line"></span><br><span class="line">        mutex.<span class="built_in">lock</span>();</span><br><span class="line">        ++bufferCount;</span><br><span class="line">        ++bufferCount;</span><br><span class="line">        <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;Producer:&quot;</span>&lt;&lt;QThread::<span class="built_in">currentThreadId</span>()</span><br><span class="line">               &lt;&lt;<span class="string">&quot;:&quot;</span>&lt;&lt;bufferCount;</span><br><span class="line">        wcBufferEmpty.<span class="built_in">wakeAll</span>(); <span class="comment">//产品数量不为空时，唤醒阻塞的消费者。</span></span><br><span class="line">        mutex.<span class="built_in">unlock</span>();</span><br><span class="line"></span><br><span class="line">        QThread::<span class="built_in">msleep</span>(<span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Customer::run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">10000</span>; ++i)&#123;</span><br><span class="line">        mutex.<span class="built_in">lock</span>();</span><br><span class="line">        <span class="keyword">if</span>(bufferCount == <span class="number">0</span>)&#123;		<span class="comment">//当产品数量为空时，阻塞，不再消费。</span></span><br><span class="line">            wcBufferEmpty.<span class="built_in">wait</span>(&amp;mutex);</span><br><span class="line">        &#125;</span><br><span class="line">        mutex.<span class="built_in">unlock</span>();</span><br><span class="line"></span><br><span class="line">        mutex.<span class="built_in">lock</span>();</span><br><span class="line">        --bufferCount;</span><br><span class="line">        <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;Coustmer:&quot;</span>&lt;&lt;QThread::<span class="built_in">currentThreadId</span>()</span><br><span class="line">                &lt;&lt;<span class="string">&quot;:&quot;</span>&lt;&lt;bufferCount;</span><br><span class="line">        <span class="comment">//当消费了产品，唤醒因为产品数量达到最大值而阻塞的生产者，开始生产。</span></span><br><span class="line">        wcBufferFull.<span class="built_in">wakeAll</span>();   </span><br><span class="line">        mutex.<span class="built_in">unlock</span>();</span><br><span class="line"></span><br><span class="line">        QThread::<span class="built_in">msleep</span>(<span class="number">300</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//main.cpp</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;main:&quot;</span>&lt;&lt;QThread::<span class="built_in">currentThreadId</span>();</span><br><span class="line"></span><br><span class="line">    Producer p;</span><br><span class="line">    Customer c;</span><br><span class="line"></span><br><span class="line">    p.<span class="built_in">start</span>();</span><br><span class="line">    c.<span class="built_in">start</span>();</span><br><span class="line"></span><br><span class="line">    p.<span class="built_in">wait</span>();</span><br><span class="line">    c.<span class="built_in">wait</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a.<span class="built_in">exec</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出为：</span><br><span class="line">Custmer:  <span class="number">0x2d40</span> : <span class="number">15</span></span><br><span class="line">Custmer:  <span class="number">0x2d40</span> : <span class="number">14</span></span><br><span class="line">Producer: <span class="number">0x4b10</span> : <span class="number">16</span></span><br><span class="line">Custmer:  <span class="number">0x2d40</span> : <span class="number">15</span></span><br><span class="line">Producer: <span class="number">0x4b10</span> : <span class="number">17</span></span><br><span class="line">Custmer:  <span class="number">0x2d40</span> : <span class="number">16</span></span><br><span class="line">Custmer:  <span class="number">0x2d40</span> : <span class="number">15</span></span><br><span class="line">Producer: <span class="number">0x4b10</span> : <span class="number">17</span></span><br><span class="line">Custmer:  <span class="number">0x2d40</span> : <span class="number">16</span></span><br><span class="line">Custmer:  <span class="number">0x2d40</span> : <span class="number">15</span></span><br><span class="line"><span class="comment">//从输出的结果看，Custmer每次消费一个，Producer每次生产2个</span></span><br></pre></td></tr></table></figure>

<h2 id="9-5-QSemaphore"><a href="#9-5-QSemaphore" class="headerlink" title="9.5 QSemaphore"></a>9.5 QSemaphore</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Producer.h</span></span><br><span class="line"><span class="comment">//Producer\Customer都继承于QThread</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Producer</span>:<span class="keyword">public</span> QThread &#123;</span><br><span class="line">        Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Producer</span>()&#123;&#125;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span><span class="keyword">override</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Customer</span>:<span class="keyword">public</span> QThread &#123;</span><br><span class="line">        Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Customer</span>()&#123;&#125;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span><span class="keyword">override</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Producer.cpp</span></span><br><span class="line"><span class="comment">//ProducerSe初始为1,为了使生产者线程启动提供条件。</span></span><br><span class="line"><span class="function">QSemaphore <span class="title">ProducerSe</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">QSemaphore CustomerSe;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Producer::run</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; ++i) &#123;</span><br><span class="line">        ProducerSe.<span class="built_in">acquire</span>();</span><br><span class="line">        <span class="type">int</span> num = QRandomGenerator::<span class="built_in">global</span>()-&gt;<span class="built_in">bounded</span>(<span class="number">5</span>);</span><br><span class="line">        <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;Producer:&quot;</span>&lt;&lt;QThread::<span class="built_in">currentThreadId</span>()</span><br><span class="line">                  &lt;&lt;<span class="string">&quot;,release source count:&quot;</span>&lt;&lt;num&lt;&lt;<span class="string">&quot;|&quot;</span>               &lt;&lt;QDateTime::<span class="built_in">currentDateTime</span>().<span class="built_in">toString</span>(Qt::ISODateWithMs);</span><br><span class="line">        CustomerSe.<span class="built_in">release</span>(num);</span><br><span class="line">        QThread::<span class="built_in">msleep</span>(<span class="number">3000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Customer::run</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; ++i) &#123;</span><br><span class="line">        CustomerSe.<span class="built_in">acquire</span>() ;</span><br><span class="line">        <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;Customer:&quot;</span>&lt;&lt;(<span class="type">int</span>*)QThread::<span class="built_in">currentThreadId</span>()&lt;&lt;<span class="string">&quot;|&quot;</span>&lt;&lt;QDateTime::<span class="built_in">currentDateTime</span>().<span class="built_in">toString</span>(Qt::ISODateWithMs);</span><br><span class="line">        ProducerSe.<span class="built_in">release</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">OUT:</span><br><span class="line">Producer: <span class="number">0x474c</span> ,release source count: <span class="number">0</span> | <span class="string">&quot;2019-09-20T10:27:10.463&quot;</span></span><br><span class="line">Producer: <span class="number">0x474c</span> ,release source count: <span class="number">2</span> | <span class="string">&quot;2019-09-20T10:27:13.463&quot;</span></span><br><span class="line">Customer: <span class="number">0x3914</span> | <span class="string">&quot;2019-09-20T10:27:13.463&quot;</span></span><br><span class="line">Customer: <span class="number">0x6acc</span> | <span class="string">&quot;2019-09-20T10:27:13.463&quot;</span></span><br><span class="line">Producer: <span class="number">0x474c</span> ,release source count: <span class="number">1</span> | <span class="string">&quot;2019-09-20T10:27:16.463&quot;</span></span><br><span class="line">Customer: <span class="number">0x6b94</span> | <span class="string">&quot;2019-09-20T10:27:16.463&quot;</span></span><br><span class="line">Producer: <span class="number">0x474c</span> ,release source count: <span class="number">1</span> | <span class="string">&quot;2019-09-20T10:27:19.465&quot;</span></span><br><span class="line">Customer: <span class="number">0x3914</span> | <span class="string">&quot;2019-09-20T10:27:19.465&quot;</span></span><br><span class="line">Producer: <span class="number">0x474c</span> ,release source count: <span class="number">3</span> | <span class="string">&quot;2019-09-20T10:27:22.477&quot;</span></span><br><span class="line">Customer: <span class="number">0x6b94</span> | <span class="string">&quot;2019-09-20T10:27:22.477&quot;</span></span><br><span class="line">Customer: <span class="number">0x4c98</span> | <span class="string">&quot;2019-09-20T10:27:22.477&quot;</span></span><br><span class="line">Customer: <span class="number">0x5190</span> | <span class="string">&quot;2019-09-20T10:27:22.477&quot;</span></span><br><span class="line"><span class="comment">//生产者每次随机释放消费者锁个数，阻塞的的消费者随机启动释放的个数。</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure>



<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main.cpp</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span> **argv)</span> </span>&#123;&#125;</span><br><span class="line">	Producer p;</span><br><span class="line">    p.<span class="built_in">start</span>();</span><br><span class="line"></span><br><span class="line">    QVector&lt;Customer*&gt; vtr;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i)&#123;</span><br><span class="line">        Customer *c = <span class="keyword">new</span> Customer;</span><br><span class="line">        QObject::<span class="built_in">connect</span>(c,&amp;Customer::finished,</span><br><span class="line">                         c,&amp;Customer::deleteLater);</span><br><span class="line">        vtr.<span class="built_in">push_back</span>(c);</span><br><span class="line">        c-&gt;<span class="built_in">start</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    p.<span class="built_in">wait</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> item : vtr)&#123;</span><br><span class="line">        <span class="keyword">if</span>(item != <span class="literal">nullptr</span>)&#123;</span><br><span class="line">            item-&gt;<span class="built_in">wait</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;item : vtr)&#123;</span><br><span class="line">        <span class="keyword">if</span>(item != <span class="literal">nullptr</span>)&#123;</span><br><span class="line">            <span class="keyword">delete</span> item;</span><br><span class="line">            item = <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="10-知识点总结"><a href="#10-知识点总结" class="headerlink" title="10.知识点总结"></a>10.知识点总结</h1><p>10.1 Qt使用系统浏览器打开指定页面 </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDesktopServices&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QUrl&gt;</span></span></span><br><span class="line"> </span><br><span class="line">QDesktopServices::<span class="built_in">openUrl</span>(<span class="built_in">QUrl</span>(<span class="string">&quot;http://www.baidu.com&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>10.2 QDateTime时间格式</p>
<p>时间格式</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//精确到毫秒</span></span><br><span class="line"><span class="comment">//Qt4</span></span><br><span class="line">QDateTime::<span class="built_in">currentDateTime</span>().<span class="built_in">toString</span>(<span class="string">&quot;yyyy-MM-dd:hh:mm:ss.zzz&quot;</span>);</span><br><span class="line"><span class="comment">//Qt5 </span></span><br><span class="line">QDateTime::<span class="built_in">currentDateTime</span>().<span class="built_in">toString</span>(Qt::ISODateWithMs);</span><br></pre></td></tr></table></figure>





<h1 id="12-mingw编译的程序读取error-h中的错误信息"><a href="#12-mingw编译的程序读取error-h中的错误信息" class="headerlink" title="12.mingw编译的程序读取error.h中的错误信息"></a>12.mingw编译的程序读取error.h中的错误信息</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QString::fromStdString(strerror(errno));</span><br></pre></td></tr></table></figure>

<h1 id="13-UI相关"><a href="#13-UI相关" class="headerlink" title="13.UI相关"></a>13.UI相关</h1><h2 id="1-tips-知识点"><a href="#1-tips-知识点" class="headerlink" title="1.tips 知识点"></a>1.tips 知识点</h2><h3 id="QWidget设置背景"><a href="#QWidget设置背景" class="headerlink" title="QWidget设置背景"></a>QWidget设置背景</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setAutoFillBackground</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="built_in">resize</span>(<span class="number">222</span>,<span class="number">222</span>);</span><br><span class="line"></span><br><span class="line">QPalette pa;</span><br><span class="line"><span class="function">QPixmap <span class="title">mp</span><span class="params">(<span class="string">&quot;:/images/warning_bg.png&quot;</span>)</span></span>;</span><br><span class="line">mp = mp.<span class="built_in">scaled</span>(<span class="built_in">size</span>());	<span class="comment">//图片根据页面大小进行缩放</span></span><br><span class="line">pa.<span class="built_in">setBrush</span>(QPalette::Window,<span class="built_in">QBrush</span>(mp));</span><br><span class="line"><span class="built_in">setMask</span>(mp.<span class="built_in">mask</span>());		<span class="comment">//将图片中的透明设置处控件也设置为透明</span></span><br><span class="line"><span class="built_in">setPalette</span>(pa);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="QWidget设置透明"><a href="#QWidget设置透明" class="headerlink" title="QWidget设置透明"></a>QWidget设置透明</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setAttribute</span>(Qt::WA_TranslucentBackground);</span><br></pre></td></tr></table></figure>

<h3 id="QWidget-flags"><a href="#QWidget-flags" class="headerlink" title="QWidget flags"></a>QWidget flags</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置到所有窗口最上端</span></span><br><span class="line"><span class="built_in">setWindowFlags</span>(Qt::WindowStaysOnTopHint);</span><br><span class="line"><span class="comment">//作用对话框关闭时，自动销毁对话框。</span></span><br><span class="line"><span class="built_in">setAttribute</span>(Qt::WA_DeleteOnClose);</span><br></pre></td></tr></table></figure>

<h3 id="界面居中"><a href="#界面居中" class="headerlink" title="界面居中"></a>界面居中</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;qapplication.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDesktopWidget&gt;</span></span></span><br><span class="line"></span><br><span class="line">QDesktopWidget* desktop = QApplication::<span class="built_in">desktop</span>(); <span class="comment">// =qApp-&gt;desktop();也可以</span></span><br><span class="line"><span class="built_in">move</span>((desktop-&gt;<span class="built_in">width</span>() - <span class="keyword">this</span>-&gt;<span class="built_in">width</span>())/<span class="number">2</span>, (desktop-&gt;<span class="built_in">height</span>() - <span class="keyword">this</span>-&gt;<span class="built_in">height</span>())/<span class="number">2</span>);</span><br></pre></td></tr></table></figure>





<h2 id="2-QDialog"><a href="#2-QDialog" class="headerlink" title="2.QDialog"></a>2.QDialog</h2><h3 id="模态和非模态"><a href="#模态和非模态" class="headerlink" title="模态和非模态"></a>模态和非模态</h3><p>如果 parent 为 NULL，则该对话框会作为一个顶层窗口，否则则作为其父组件的子对话框（此时，其默认出现的位置是 parent 的中心）。</p>
<p>顶层窗口与非顶层窗口的区别在于</p>
<ul>
<li>顶层窗口在任务栏会有自己的位置，</li>
<li>非顶层窗口则会共享其父组件的位置，无任务栏图标。</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>警告对话框嵌套在一个页面中，警告对话框周围透明。</span><br><span class="line"><span class="number">2.</span>对话框事件循环</span><br><span class="line"><span class="number">3.</span>QApplication::processEvents</span><br></pre></td></tr></table></figure>



<h4 id="对话框类型："><a href="#对话框类型：" class="headerlink" title="对话框类型："></a>对话框类型：</h4><p>模态和非模态，Qt 有两种级别的模态对话框：应用程序级别的模态和窗口级别的模态，默认是应用程序级别的模态。</p>
<p>应用程序级别的模态是指，当该种模态的对话框出现时，用户必须首先对对话框进行交互，直到关闭对话框，然后才能访问程序中其他的窗口。</p>
<p>窗口级别的模态是指，该模态仅仅阻塞与对话框关联的窗口，但是依然允许用户与程序中其它窗口交互。</p>
<h3 id="exec和show的区别："><a href="#exec和show的区别：" class="headerlink" title="exec和show的区别："></a>exec和show的区别：</h3><ul>
<li>如果使用exec（）默认为模态的。如果用show（）需要设置setModel（true）才是模态的。</li>
<li>exec有返回值，show没有。</li>
<li><strong>当Qdialog设置了属性：setWindowFlags(Qt::FramelessWindowHint);去掉自带的title时，一定要加上属性Qt::Dialog,即：setWindowFlags(Qt::FramelessWindowHint|Qt::Dialog);，否则exec（）将不会实现阻塞的作用，也就是父窗口仍然可以接受输入。</strong></li>
<li>close（）会销毁对象嘛。答案是只有当设置了 setAttribute（WA:closeOnDelelte）是才会删除，如果这个标志没有设置，其作用和hide（），setvisible（false）一样，只会隐藏改对象。</li>
</ul>
<h2 id="3-翻译"><a href="#3-翻译" class="headerlink" title="3.翻译"></a>3.翻译</h2><p>详细介绍</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/oloroso/p/4596740.html">https://www.cnblogs.com/oloroso/p/4596740.html</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.首先在pro文件中添加</span></span><br><span class="line">TRANSLATIONS = ui.ts</span><br><span class="line"><span class="comment">//2.打开windows命令行</span></span><br><span class="line"><span class="comment">//生成ui.ts文件</span></span><br><span class="line">lupdate.exe translation.pro -ts ui.ts</span><br><span class="line"><span class="comment">//3.打开linguist.exe程序，对ui.ts文件进行翻译</span></span><br><span class="line"><span class="comment">//4.生成ui.qm文件</span></span><br><span class="line">lrelease.exe ui.ts -qm zh.qm</span><br><span class="line"><span class="comment">//5.添加代码，加载翻译文件</span></span><br><span class="line">QTranslator translator;</span><br><span class="line">translator.<span class="built_in">load</span>(<span class="string">&quot;zh.qm&quot;</span>);</span><br><span class="line">app.<span class="built_in">installTranslator</span>(&amp;translator);</span><br></pre></td></tr></table></figure>



<p>此时已经可以完成当前界面的翻译，然后如果每个页面都需要，则需要在每个界面加入</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dialog_Language::changeEvent</span><span class="params">(QEvent *e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QWidget::<span class="built_in">changeEvent</span>(e);</span><br><span class="line">    <span class="keyword">switch</span> (e-&gt;<span class="built_in">type</span>()) &#123;</span><br><span class="line">    <span class="keyword">case</span> QEvent::LanguageChange:</span><br><span class="line">        ui-&gt;<span class="built_in">retranslateUi</span>(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="4-tableview代理"><a href="#4-tableview代理" class="headerlink" title="4.tableview代理"></a>4.tableview代理</h2><h1 id="14"><a href="#14" class="headerlink" title="14."></a>14.</h1><h1 id="15-Qt武林秘籍"><a href="#15-Qt武林秘籍" class="headerlink" title="15.Qt武林秘籍"></a>15.Qt武林秘籍</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>：当编译发现大量错误的时候，从第一个看起，一个一个的解决，不要急着去看下一个错误，往往后面的错误都是由于前面的错误引起的，第一个解决后很可能都解决了。</span><br><span class="line"><span class="number">2</span>：定时器是个好东西，学会好使用它，有时候用QTimer::singleShot可以解决意想不到的问题。</span><br><span class="line"><span class="number">3</span>：打开creator，在构建套件的环境中增加 MAKEFLAGS=-j8，可以不用每次设置多线程编译。珍爱时间和生命。</span><br><span class="line"><span class="number">4</span>：如果你想顺利用QtCreator部署安卓程序，首先你要在AndroidStudio 里面配置成功，把坑全部趟平。</span><br><span class="line"><span class="number">5</span>：很多时候找到Qt对应封装的方法后，记得多看看该函数的重载，多个参数的，你会发现不一样的世界，有时候会恍然大悟，原来Qt已经帮我们封装好了。</span><br><span class="line"></span><br><span class="line"><span class="number">6</span>：可以在pro文件中写上标记版本号+ico图标</span><br><span class="line">VERSION   	= <span class="number">2018.7</span><span class="number">.25</span></span><br><span class="line">RC_ICONS    = main0.ico</span><br><span class="line"></span><br><span class="line"><span class="number">7</span>：管理员运行程序，限定在MSVC编译器。</span><br><span class="line">QMAKE_LFLAGS += /MANIFESTUAC:\<span class="string">&quot;level=\&#x27;requireAdministrator\&#x27; uiAccess=\&#x27;false\&#x27;\&quot; #以管理员运行</span></span><br><span class="line"><span class="string">QMAKE_LFLAGS += /SUBSYSTEM:WINDOWS,\&quot;5.01\&quot; #VS2013 在XP运行</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">8：运行文件附带调试输出窗口</span></span><br><span class="line"><span class="string">CONFIG += console pro</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">9：绘制平铺背景QPainter::drawTiledPixmap</span></span><br><span class="line"><span class="string">绘制圆角矩形QPainter::drawRoundedRect(),而不是QPainter::drawRoundRect();</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">10：移除旧的样式</span></span><br><span class="line"><span class="string">style()-&gt;unpolish(ui-&gt;btn);</span></span><br><span class="line"><span class="string">重新设置新的该控件的样式。</span></span><br><span class="line"><span class="string">style()-&gt;polish(ui-&gt;btn);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">11：获取类的属性</span></span><br><span class="line"><span class="string">const QMetaObject *metaobject = object-&gt;metaObject();</span></span><br><span class="line"><span class="string">int count = metaobject-&gt;propertyCount();</span></span><br><span class="line"><span class="string">for (int i = 0; i &lt; count; ++i) &#123;</span></span><br><span class="line"><span class="string">    QMetaProperty metaproperty = metaobject-&gt;property(i);</span></span><br><span class="line"><span class="string">    const char *name = metaproperty.name();</span></span><br><span class="line"><span class="string">    QVariant value = object-&gt;property(name);</span></span><br><span class="line"><span class="string">    qDebug() &lt;&lt; name &lt;&lt; value;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">12：Qt内置图标封装在QStyle中，大概七十多个图标，可以直接拿来用。</span></span><br><span class="line"><span class="string">QStyle::SP_TitleBarMenuButton</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">13：根据操作系统位数判断加载</span></span><br><span class="line"><span class="string">win32 &#123;</span></span><br><span class="line"><span class="string">    contains(DEFINES, WIN64) &#123;</span></span><br><span class="line"><span class="string">        DESTDIR = $$&#123;PWD&#125;/../../bin64</span></span><br><span class="line"><span class="string">    &#125; else &#123;</span></span><br><span class="line"><span class="string">        DESTDIR = $$&#123;PWD&#125;/../../bin32</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">14：Qt5增强了很多安全性验证，如果出现setGeometry: Unable to set geometry，请将该控件的可见移到加入布局之后。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">15：可以将控件A添加到布局，然后控件B设置该布局，这种灵活性大大提高了控件的组合度，比如可以在文本框左侧右侧增加一个搜索按钮，按钮设置图标即可。</span></span><br><span class="line"><span class="string">QPushButton *btn = new QPushButton;</span></span><br><span class="line"><span class="string">btn-&gt;resize(30, ui-&gt;lineEdit-&gt;height());</span></span><br><span class="line"><span class="string">QHBoxLayout *layout = new QHBoxLayout(ui-&gt;lineEdit);</span></span><br><span class="line"><span class="string">layout-&gt;setMargin(0);</span></span><br><span class="line"><span class="string">layout-&gt;addStretch();</span></span><br><span class="line"><span class="string">layout-&gt;addWidget(btn);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">16：对QLCDNumber控件设置样式，需要将QLCDNumber的segmentstyle设置为flat。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">17：巧妙的使用findChildren可以查找该控件下的所有子控件。findChild为查找单个。</span></span><br><span class="line"><span class="string">//查找指定类名objectName的控件</span></span><br><span class="line"><span class="string">QList&lt;QWidget *&gt; widgets = parentWidget.findChildren&lt;QWidget *&gt;(&quot;</span>widgetname<span class="string">&quot;);</span></span><br><span class="line"><span class="string">//查找所有QPushButton</span></span><br><span class="line"><span class="string">QList&lt;QPushButton *&gt; allPButtons = parentWidget.findChildren&lt;QPushButton *&gt;();</span></span><br><span class="line"><span class="string">//查找一级子控件,不然会一直遍历所有子控件</span></span><br><span class="line"><span class="string">QList&lt;QPushButton *&gt; childButtons = parentWidget.findChildren&lt;QPushButton *&gt;(QString(), Qt::FindDirectChildrenOnly);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">18：巧妙的使用inherits判断是否属于某种类。</span></span><br><span class="line"><span class="string">QTimer *timer = new QTimer;         // QTimer inherits QObject</span></span><br><span class="line"><span class="string">timer-&gt;inherits(&quot;</span>QTimer<span class="string">&quot;);          // returns true</span></span><br><span class="line"><span class="string">timer-&gt;inherits(&quot;</span>QObject<span class="string">&quot;);         // returns true</span></span><br><span class="line"><span class="string">timer-&gt;inherits(&quot;</span>QAbstractButton<span class="string">&quot;); // returns false</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">19：使用弱属性机制，可以存储临时的值用于传递判断。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">20：在开发时, 无论是出于维护的便捷性, 还是节省内存资源的考虑, 都应该有一个 qss 文件来存放所有的样式表, 而不应该将 setStyleSheet 写的到处都是。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">21：如果出现Z-order assignment: &quot;</span> is <span class="keyword">not</span> a valid widget.错误提示，用记事本打开对应的ui文件，找到&lt;zorder&gt;&lt;/zorder&gt;为空的地方，删除即可。</span><br><span class="line"></span><br><span class="line"><span class="number">22</span>：善于利用QComboBox的addItem的第二个参数设置用户数据，可以实现很多效果，使用itemData取出来。</span><br><span class="line"></span><br><span class="line"><span class="number">23</span>：如果用了webengine模块，发布程序的时候带上QtWebEngineProcess.exe+translations文件夹+resources文件夹。</span><br><span class="line"></span><br><span class="line"><span class="number">24</span>：a.<span class="built_in">setAttribute</span>(Qt::AA_NativeWindows);可以让每个控件都拥有独立的句柄。</span><br><span class="line"></span><br><span class="line"><span class="number">25</span>：Qt+Android防止程序被关闭。</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(Q_OS_ANDROID)</span></span><br><span class="line"><span class="function">QAndroidService <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line"><span class="keyword">return</span> a.<span class="built_in">exec</span>()</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">QApplication <span class="built_in">a</span>(argc, argv);</span><br><span class="line"><span class="keyword">return</span> a.<span class="built_in">exec</span>();</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="number">26</span>：可以对整体的指示器设置样式，例如 *::down-arrow,*::menu-indicator&#123;&#125;  *::up-arrow:disabled,*::up-arrow:off&#123;&#125;。</span><br><span class="line"></span><br><span class="line"><span class="number">27</span>：可以执行位置设置背景图片。</span><br><span class="line">QMainWindow &gt; .QWidget &#123;</span><br><span class="line">    background-color: gainsboro;</span><br><span class="line">    background-image: <span class="built_in">url</span>(:/images/pagefold.png);</span><br><span class="line">    background-position: top right;</span><br><span class="line">    background-repeat: no-repeat</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">28</span>：嵌入式linux运行Qt程序  Qt4写法：./HelloQt -qws &amp;   Qt5写法：./HelloQt --platform xcb</span><br><span class="line"><span class="number">29</span>：Qtcreator软件的配置文件存放在：C:\Users\Administrator\AppData\Roaming\QtProject，有时候如果发现出问题了，将这个文件夹删除后打开creator自动重新生成即可。</span><br><span class="line"><span class="number">30</span>：QMediaPlayer依赖本地解码器，WIN上下载k-lite或者LAV Filters安装即可。</span><br><span class="line"><span class="number">31</span>：代码判断MSVC编译器版本，<span class="keyword">if</span> (_MSC_VER == <span class="number">1800</span>)，对应关系<span class="number">2013</span>=<span class="number">1800</span>  <span class="number">2012</span>=<span class="number">1700</span>  <span class="number">2010</span>=<span class="number">1600</span>  <span class="number">2008</span>=<span class="number">1500</span>  <span class="number">2005</span>=<span class="number">1400</span></span><br><span class="line"><span class="number">32</span>：在pro中判断不同平台：<span class="built_in">message</span>($$QT_ARCH) <span class="built_in">contains</span>(QT_ARCH,arm)。</span><br><span class="line"><span class="number">33</span>：Qt最小化后恢复界面假死冻结，加上代码</span><br><span class="line"><span class="type">void</span> <span class="built_in">showEvent</span>(QShowEvent *e)&#123;</span><br><span class="line"><span class="built_in">setAttribute</span>(Qt::WA_Mapped);</span><br><span class="line">QWidget::<span class="built_in">showEvent</span>(e);</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">34</span>：获取标题栏高度：<span class="built_in">style</span>()-&gt;<span class="built_in">pixelMetric</span>(QStyle::PM_TitleBarHeight); PM_TitleBarHeight点进去你会发现新大陆。</span><br><span class="line"><span class="number">35</span>：设置高分屏属性以便支持<span class="number">2</span>K4K等高分辨率，尤其是手机app。必须写在main函数的<span class="function">QApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;的前面。</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> (QT_VERSION &gt; QT_VERSION_CHECK(5,6,0))</span></span><br><span class="line">    QGuiApplication::<span class="built_in">setAttribute</span>(Qt::AA_EnableHighDpiScaling);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="number">36</span>：如果运行程序出现 Fault tolerant heap shim applied to current process. This is usually due to previous crashes. 错误。</span><br><span class="line">办法：打开注册表，找到HKEY_LOCAL_MACHINE\Software\Microsoft\Windows  NT\CurrentVersion\AppCompatFlags\Layers\，选中Layers键值，从右侧列表中删除自己的那个程序路径即可。</span><br><span class="line"><span class="number">37</span>：Qt内置了QFormLayout表单布局用于自动生成标签+输入框的组合的表单界面。</span><br><span class="line"><span class="number">38</span>：qml播放视频在linux需要安装 sudo apt-get install libpulse-dev。</span><br><span class="line"><span class="number">39</span>：可以直接继承QSqlQueryModel实现自定义的QueryModel，比如某一列字体颜色，占位符，其他样式等，重写<span class="function">QVariant <span class="title">CustomSqlModel::data</span><span class="params">(<span class="type">const</span> QModelIndex &amp;index, <span class="type">int</span> role)</span> <span class="type">const</span>。</span></span><br><span class="line"><span class="function">40：Qt5以后提供了类QScroller直接将控件滚动。</span></span><br><span class="line"><span class="function">ui-&gt;listWidget-&gt;<span class="title">setHorizontalScrollMode</span><span class="params">(QListWidget::ScrollPerPixel)</span></span>;</span><br><span class="line">QScroller::<span class="built_in">grabGesture</span>(ui-&gt;listWidget,QScroller::LeftMouseButtonGesture);</span><br><span class="line"><span class="number">41</span>：如果使用sqlite数据库不想产生数据库文件，可以创建内存数据库。</span><br><span class="line">QSqlDatabase db = QSqlDatabase::<span class="built_in">addDatabase</span>(<span class="string">&quot;QSQLITE&quot;</span>);</span><br><span class="line">db.<span class="built_in">setDatabaseName</span>(<span class="string">&quot;:memory:&quot;</span>);</span><br><span class="line"><span class="number">42</span>：清空数据表并重置自增ID，sql = truncate table table_name。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">94</span>：Qt界的中文乱码问题，版本众多导致的如何选择安装包问题，如何打包发布程序的问题，堪称Qt界的三座大山！</span><br><span class="line"><span class="number">95</span>：Qt安装目录下的Examples目录下的例子，看完学完，月薪<span class="number">20</span>K起步。</span><br><span class="line"><span class="number">96</span>：崩溃的<span class="number">80</span>%都是因为要么越界，要么未初始化，死扣这两点，<span class="number">80</span>%的问题解决了。</span><br><span class="line"><span class="number">97</span>：我一般保留四个版本，为了兼容qt4用<span class="number">4.8</span><span class="number">.7</span>, 最后的支持XP的版本<span class="number">5.7</span><span class="number">.0</span>， 最新的长期支持版本<span class="number">5.9</span><span class="number">.7</span> 最高的新版本比如<span class="number">5.12</span>。</span><br><span class="line"><span class="number">98</span>：看qt源码的网站：https:<span class="comment">//code.woboq.org/qt5/</span></span><br><span class="line"><span class="number">99</span>：终极秘籍：如果遇到问题搜索Qt方面找不到答案，试着将关键字用JAVA C<span class="meta"># android打头，你会发现别有一番天地，其他人很可能做过！</span></span><br><span class="line"><span class="number">100</span>：最后一条：珍爱生命，远离编程。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="16-添加Qt插件库"><a href="#16-添加Qt插件库" class="headerlink" title="16.添加Qt插件库"></a>16.添加Qt插件库</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QCoreApplication::<span class="built_in">addLibraryPath</span>(QCoreApplication::<span class="built_in">applicationDirPath</span>() + <span class="string">&quot;/plugins&quot;</span>);</span><br></pre></td></tr></table></figure>

<h1 id="17-vs"><a href="#17-vs" class="headerlink" title="17.vs"></a>17.vs</h1><h2 id="17-1-vs-编辑TableView表头乱码"><a href="#17-1-vs-编辑TableView表头乱码" class="headerlink" title="17.1 vs 编辑TableView表头乱码"></a>17.1 vs 编辑TableView表头乱码</h2><p>添加一下代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> execution_character_set(<span class="string">&quot;utf-8&quot;</span>)</span></span><br></pre></td></tr></table></figure>





<h1 id="18-智能指针"><a href="#18-智能指针" class="headerlink" title="18.智能指针"></a>18.智能指针</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/liyuanbhu/article/details/77825655">Qt中的智能指针介绍</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/luoyayun361/article/details/90255944">QSharedPointer</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/luoyayun361/article/details/90286005">QWeakPointer</a></p>
<h1 id="19-stylesheet"><a href="#19-stylesheet" class="headerlink" title="19.stylesheet"></a>19.stylesheet</h1><h1 id="20-QTcpSocket"><a href="#20-QTcpSocket" class="headerlink" title="20.QTcpSocket"></a>20.QTcpSocket</h1><h1 id="21-QSharedMemory"><a href="#21-QSharedMemory" class="headerlink" title="21.QSharedMemory"></a>21.QSharedMemory</h1><h1 id="22-编译QuaZip"><a href="#22-编译QuaZip" class="headerlink" title="22.编译QuaZip"></a>22.编译QuaZip</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/qiyawei/p/10695192.html"><a target="_blank" rel="noopener" href="https://www.cnblogs.com/qiyawei/p/10695192.html">Qt之QuaZip编译-使用教程</a> </a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/damei6677/Qt/Qt.html" data-id="clji7crpk00076s4l2d64cgnx" data-title="" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2023/06/">June 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2023/06/30/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">Home</a>
  
    <a href="/blog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/blog/js/jquery-3.6.4.min.js"></script>



  
<script src="/blog/fancybox/jquery.fancybox.min.js"></script>




<script src="/blog/js/script.js"></script>





  </div>
</body>
</html>